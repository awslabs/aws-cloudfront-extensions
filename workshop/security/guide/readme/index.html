<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.79.1"><meta name=description content><link rel="shortcut icon" href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/images/favicon.ico type=image/x-icon><title>Deployment :: CloudFront Extensions</title><link href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/css/nucleus.css?1661243409 rel=stylesheet><link href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/css/fontawesome-all.min.css?1661243409 rel=stylesheet><link href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/css/hybrid.css?1661243409 rel=stylesheet><link href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/css/featherlight.min.css?1661243409 rel=stylesheet><link href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/css/perfect-scrollbar.min.css?1661243409 rel=stylesheet><link href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/css/auto-complete.css?1661243409 rel=stylesheet><link href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/css/atom-one-dark-reasonable.css?1661243409 rel=stylesheet><link href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/css/theme.css?1661243409 rel=stylesheet><link href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/css/hugo-theme.css?1661243409 rel=stylesheet><link href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/css/theme-cloudfrontext.css?1661243409 rel=stylesheet><script src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/js/jquery-3.3.1.min.js?1661243409></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=https://awslabs.github.io/aws-cloudfront-extensions/workshop/security/guide/readme/><nav id=sidebar><div id=header-wrapper><div id=header><a id=logo href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/><img src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/images/logo.png alt="AWS Logo" width=44% height=44%></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label><input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/js/lunr.min.js?1661243409></script><script type=text/javascript src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/js/auto-complete.js?1661243409></script><script type=text/javascript>var baseurl="https:\/\/awslabs.github.io\/aws-cloudfront-extensions\/workshop\/";</script><script type=text/javascript src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/js/search.js?1661243409></script></div><div class=highlightable><ul class=topics><li data-nav-id=/prerequisite/ title=Prerequisite class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/prerequisite/>Prerequisite</a><ul><li data-nav-id=/prerequisite/aws-cloudshell/readme/ title="AWS CloudShell" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/prerequisite/aws-cloudshell/readme/>AWS CloudShell</a></li><li data-nav-id=/prerequisite/aws-cdk/readme/ title="AWS CDK" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/prerequisite/aws-cdk/readme/>AWS CDK</a></li><li data-nav-id=/prerequisite/aws-config/readme/ title="Configure your credentials" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/prerequisite/aws-config/readme/>Configure your credentials</a></li></ul></li><li data-nav-id=/deploy/ title="Deploy with CloudFront Extensions" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/deploy/>Deploy with CloudFront Extensions</a><ul><li data-nav-id=/deploy/deploy-auth/readme/ title="Deploy a Lambda@Edge function to authenticate with Cognito" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/deploy/deploy-auth/readme/>Deploy a Lambda@Edge function to authenticate with Cognito</a></li><li data-nav-id=/deploy/deploy-device/readme/ title="Deploy a Lambda@Edge function to serve based on devices" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/deploy/deploy-device/readme/>Deploy a Lambda@Edge function to serve based on devices</a></li></ul></li><li data-nav-id=/develop/ title="Develop with CloudFront Extensions" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/develop/>Develop with CloudFront Extensions</a><ul><li data-nav-id=/develop/cloudfront-distribution/readme/ title="Create a CloudFront Distribution" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/develop/cloudfront-distribution/readme/>Create a CloudFront Distribution</a></li><li data-nav-id=/develop/download-code/readme/ title="Upload CloudFront Extensions code into CloudShell" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/develop/download-code/readme/>Upload CloudFront Extensions code into CloudShell</a></li><li data-nav-id=/develop/code-structure/readme/ title="Understand CloudFront Extensions code structure" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/develop/code-structure/readme/>Understand CloudFront Extensions code structure</a></li><li data-nav-id=/develop/edge-function/readme/ title="Create a Lambda@Edge function" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/develop/edge-function/readme/>Create a Lambda@Edge function</a></li><li data-nav-id=/develop/test-function/readme/ title="Test the Lambda@Edge function" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/develop/test-function/readme/>Test the Lambda@Edge function</a></li><li data-nav-id=/develop/trigger-function/readme/ title="Trigger from CloudFront" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/develop/trigger-function/readme/>Trigger from CloudFront</a></li></ul></li><li data-nav-id=/security/ title="WAF & Shield Deployment" class="dd-item
parent"><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/security/>WAF & Shield Deployment</a><ul><li data-nav-id=/security/guide/readme/ title=Deployment class="dd-item active"><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/security/guide/readme/>Deployment</a></li></ul></li><li data-nav-id=/security-practice/ title="WAF & Shield Best Practice" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/security-practice/>WAF & Shield Best Practice</a><ul><li data-nav-id=/security-practice/juice-shop/readme/ title="Deploy OWASP Juice Shop" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/security-practice/juice-shop/readme/>Deploy OWASP Juice Shop</a></li><li data-nav-id=/security-practice/deploy/readme/ title="Deploy WAF & Shield Automations" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/security-practice/deploy/readme/>Deploy WAF & Shield Automations</a></li><li data-nav-id=/security-practice/rule-testing/readme/ title="Web ACLs and Managed Rules" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/security-practice/rule-testing/readme/>Web ACLs and Managed Rules</a></li><li data-nav-id=/security-practice/flood-testing/readme/ title="Prevent DDoS attacks" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/security-practice/flood-testing/readme/>Prevent DDoS attacks</a></li></ul></li><li data-nav-id=/contribution/ title=Contribution class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/contribution/>Contribution</a><ul><li data-nav-id=/contribution/pr/readme/ title="Contributing via pull requests" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/contribution/pr/readme/>Contributing via pull requests</a></li><li data-nav-id=/contribution/bug-report/readme/ title="Reporting issues" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/contribution/bug-report/readme/>Reporting issues</a></li></ul></li><li data-nav-id=/cleanup/ title=Cleanup class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/cleanup/>Cleanup</a><ul><li data-nav-id=/cleanup/s3-bucket/readme/ title="S3 bucket" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/cleanup/s3-bucket/readme/>S3 bucket</a></li><li data-nav-id=/cleanup/cognito-user-pool/readme/ title="Cognito User Pool" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/cleanup/cognito-user-pool/readme/>Cognito User Pool</a></li><li data-nav-id=/cleanup/cf-distribution/readme/ title="CloudFront distribution" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/cleanup/cf-distribution/readme/>CloudFront distribution</a></li><li data-nav-id=/cleanup/cloudformation/readme/ title=CloudFormation class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/cleanup/cloudformation/readme/>CloudFormation</a></li><li data-nav-id=/cleanup/cloudshell/readme/ title=CloudShell class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/cleanup/cloudshell/readme/>CloudShell</a></li><li data-nav-id=/cleanup/waf/readme/ title="WAF & Shield Automations" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/cleanup/waf/readme/>WAF & Shield Automations</a></li></ul></li><li data-nav-id=/reference/ title="Reference & Resources" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/reference/>Reference & Resources</a></li></ul><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value;">
<option id=en value=https://awslabs.github.io/aws-cloudfront-extensions/workshop/security/guide/readme/ selected>English</option></select><svg id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li></ul></section><section id=footer><left><a class=github-button href=https://github.com/awslabs/aws-cloudfront-extensions data-icon=octicon-cloud-download aria-label="Repo of awslabs/aws-cloudfront-extension on GitHub">Repo</a>
<a class=github-button href=https://github.com/awslabs/aws-cloudfront-extensions data-icon=octicon-star data-show-count=false aria-label="Star awslabs/aws-cloudfront-extension on GitHub">Star</a>
<a class=github-button href=https://github.com/awslabs/aws-cloudfront-extensions/fork data-icon=octicon-repo-forked data-show-count=false aria-label="Fork awslabs/aws-cloudfront-extension on GitHub">Fork</a><p><a href="https://aws.amazon.com/privacy/?nc1=f_pr">Privacy</a> | <a href="https://aws.amazon.com/terms/?nc1=f_pr">Site Terms</a> | © 2021, Amazon Web Services, Inc. or its affiliates. All rights reserved</p></left><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span><span class=links><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/>CloudFront Extensions workshop</a> > <a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/security/>WAF & Shield Deployment</a> > Deployment</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li><a href=#deploy-by-cloudformation>Deploy by CloudFormation</a></li><li><a href=#associate-the-web-acl-with-your-web-application>Associate the Web ACL with Your Web Application</a></li><li><a href=#configure-web-access-logging>Configure Web Access Logging</a></li><li><a href=#uninstall-solution>Uninstall Solution</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Deployment</h1><ul><li><a href=https://github.com/awslabs/aws-cloudfront-extensions/tree/main/templates/aws-cloudfront-waf>Source code</a></li><li><a href=https://aws-gcr-solutions.s3.amazonaws.com/aws-cloudfront-extensions/latest/AwsCloudfrontWafStack.template>CloudFormation template</a></li></ul><p>Estimated deployment time: 10 min</p><h3 id=deploy-by-cloudformation>Deploy by CloudFormation</h3><ol><li><p>The template launches in the US East (N. Virginia) Region by default. You can deploy the WAF&Shield Automcation Solution with existing AWS CloudFormation templates.<a href="https://console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks/new?stackName=WAFWorkshopSampleWebApp&templateURL=https://aws-gcr-solutions.s3.amazonaws.com/aws-cloudfront-extensions/latest/AwsCloudfrontWafStack.template"><img src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/images/deploy_to_aws.png alt="Deploy WAF&Shield"></a></p></li><li><p>Under Parameters, review the parameters for the template, and modify them as necessary. To opt out of a particular feature, choose none or no as applicable.
<img src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/images/waf_params.png alt=Architecture><div class="notices note"><p>Specifies whether this is for an AWS CloudFront distribution or for a regional application. A regional application can be an Application Load Balancer (ALB), an Amazon API Gateway REST API, or an AWS AppSync GraphQL API. Valid Values are CLOUDFRONT and REGIONAL. For CLOUDFRONT, you must create your WAFv2 resources in the US East (N. Virginia) Region, us-east-1.</p></div></p></li><li><p>Choose <strong>Next</strong>.</p></li><li><p>On the <strong>Configure stack options</strong> page, you can specify tags (key-value pairs) for resources in your stack and set additional options, and then choose <strong>Next</strong>.</p></li><li><p>On the <strong>Review</strong> page, review and confirm the settings. Check the boxes acknowledging that the template will create AWS Identity and Access Management (IAM) resources and any additional capabilities required.</p></li><li><p>Choose <strong>Create</strong> to deploy the stack.</p></li><li><p>To see details for the stack resources, choose the <strong>Outputs</strong> tab.</p></li></ol><h3 id=associate-the-web-acl-with-your-web-application>Associate the Web ACL with Your Web Application</h3><p>Update your Amazon CloudFront distribution(s) to activate AWS WAF and logging using the resources you generated.</p><h3 id=configure-web-access-logging>Configure Web Access Logging</h3><p>Configure Amazon CloudFront to send web access logs to the appropriate Amazon S3 bucket so that this data is available for the Log Parser AWS Lambda function.
Store Web Access Logs from a CloudFront Distribution</p><ol><li>Open the <a href=https://console.aws.amazon.com/cloudfront/>Amazon CloudFront console</a>.</li><li>Select your web application’s distribution, and choose <strong>Distribution Settings</strong>.</li><li>On the <strong>General</strong> tab, choose <strong>Edit</strong>.</li><li>For <strong>AWS WAF Web ACL</strong>, choose the web ACL the solution created (the same name you assigned to the stack during initial configuration).</li><li>For <strong>Logging</strong>, choose <strong>On</strong>.</li><li>For <strong>Bucket for Logs</strong>, choose the Amazon S3 bucket that you want use to store web access logs (Defined in the parameter). The drop-down list enumerates the buckets associated with the current AWS account.</li><li>Set the log prefix as <code>AWSLogs/</code>. If you enter <code>AWSLogs</code> as the prefix but get a message saying <strong>prefix cannot start with ‘AWSLogs’</strong>, then remove the prefix. Application Load Balancer will use <code>AWSLogs</code> as the default prefix.</li><li>Choose <strong>Yes</strong>, <strong>edit</strong> to save your changes.</li></ol><p>For more information, see <a href=https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/AccessLogs.html>Access Logs</a> in the Amazon CloudFront Developer Guide.</p><h3 id=uninstall-solution>Uninstall Solution</h3><p>To uninstall the solution, delete the CloudFormation stacks:</p><ol><li>Sign in to the <a href=https://console.aws.amazon.com/cloudformation/home?>AWS CloudFormation console</a>.</li><li>Select the solution’s parent stack. All other solution stacks will be deleted automatically.</li><li>Choose <strong>Delete</strong>.</li></ol><div class="notices note"><p>Uninstalling the solution deletes all the AWS resources used by the solution except for the Amazon S3 buckets. If some IP sets fail to delete due to rate exceeded throttling issue caused by the AWA WAF API limits, manually delete those IP sets and then delete the stack.</p></div><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/security/ title="WAF & Shield Deployment"><i class="fa fa-chevron-left"></i></a><a class="nav nav-next" href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/security-practice/ title="WAF & Shield Best Practice" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/js/clipboard.min.js?1661243409></script><script src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/js/perfect-scrollbar.min.js?1661243409></script><script src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/js/perfect-scrollbar.jquery.min.js?1661243409></script><script src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/js/jquery.sticky.js?1661243409></script><script src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/js/featherlight.min.js?1661243409></script><script src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/js/highlight.pack.js?1661243409></script><script>hljs.initHighlightingOnLoad();</script><script src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/js/modernizr.custom-3.6.0.js?1661243409></script><script src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/js/learn.js?1661243409></script><script src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/js/hugo-learn.js?1661243409></script><script src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/mermaid/mermaid.js?1661243409></script><script>mermaid.initialize({startOnLoad:true});</script></body></html>