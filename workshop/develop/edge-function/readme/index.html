<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.79.1"><meta name=description content><link rel="shortcut icon" href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/images/favicon.ico type=image/x-icon><title>Create a Lambda@Edge function :: CloudFront Extensions</title><link href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/css/nucleus.css?1665657764 rel=stylesheet><link href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/css/fontawesome-all.min.css?1665657764 rel=stylesheet><link href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/css/hybrid.css?1665657764 rel=stylesheet><link href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/css/featherlight.min.css?1665657764 rel=stylesheet><link href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/css/perfect-scrollbar.min.css?1665657764 rel=stylesheet><link href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/css/auto-complete.css?1665657764 rel=stylesheet><link href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/css/atom-one-dark-reasonable.css?1665657764 rel=stylesheet><link href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/css/theme.css?1665657764 rel=stylesheet><link href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/css/hugo-theme.css?1665657764 rel=stylesheet><link href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/css/theme-cloudfrontext.css?1665657764 rel=stylesheet><script src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/js/jquery-3.3.1.min.js?1665657764></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=https://awslabs.github.io/aws-cloudfront-extensions/workshop/develop/edge-function/readme/><nav id=sidebar><div id=header-wrapper><div id=header><a id=logo href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/><img src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/images/logo.png alt="AWS Logo" width=44% height=44%></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label><input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/js/lunr.min.js?1665657764></script><script type=text/javascript src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/js/auto-complete.js?1665657764></script><script type=text/javascript>var baseurl="https:\/\/awslabs.github.io\/aws-cloudfront-extensions\/workshop\/";</script><script type=text/javascript src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/js/search.js?1665657764></script></div><div class=highlightable><ul class=topics><li data-nav-id=/prerequisite/ title=Prerequisite class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/prerequisite/>Prerequisite</a><ul><li data-nav-id=/prerequisite/aws-cloudshell/readme/ title="AWS CloudShell" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/prerequisite/aws-cloudshell/readme/>AWS CloudShell</a></li><li data-nav-id=/prerequisite/aws-cdk/readme/ title="AWS CDK" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/prerequisite/aws-cdk/readme/>AWS CDK</a></li><li data-nav-id=/prerequisite/aws-config/readme/ title="Configure your credentials" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/prerequisite/aws-config/readme/>Configure your credentials</a></li></ul></li><li data-nav-id=/deploy/ title="Deploy with CloudFront Extensions" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/deploy/>Deploy with CloudFront Extensions</a><ul><li data-nav-id=/deploy/deploy-auth/readme/ title="Deploy a Lambda@Edge function to authenticate with Cognito" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/deploy/deploy-auth/readme/>Deploy a Lambda@Edge function to authenticate with Cognito</a></li><li data-nav-id=/deploy/deploy-device/readme/ title="Deploy a Lambda@Edge function to serve based on devices" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/deploy/deploy-device/readme/>Deploy a Lambda@Edge function to serve based on devices</a></li></ul></li><li data-nav-id=/develop/ title="Develop with CloudFront Extensions" class="dd-item
parent"><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/develop/>Develop with CloudFront Extensions</a><ul><li data-nav-id=/develop/cloudfront-distribution/readme/ title="Create a CloudFront Distribution" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/develop/cloudfront-distribution/readme/>Create a CloudFront Distribution</a></li><li data-nav-id=/develop/download-code/readme/ title="Upload CloudFront Extensions code into CloudShell" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/develop/download-code/readme/>Upload CloudFront Extensions code into CloudShell</a></li><li data-nav-id=/develop/code-structure/readme/ title="Understand CloudFront Extensions code structure" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/develop/code-structure/readme/>Understand CloudFront Extensions code structure</a></li><li data-nav-id=/develop/edge-function/readme/ title="Create a Lambda@Edge function" class="dd-item active"><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/develop/edge-function/readme/>Create a Lambda@Edge function</a></li><li data-nav-id=/develop/test-function/readme/ title="Test the Lambda@Edge function" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/develop/test-function/readme/>Test the Lambda@Edge function</a></li><li data-nav-id=/develop/trigger-function/readme/ title="Trigger from CloudFront" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/develop/trigger-function/readme/>Trigger from CloudFront</a></li></ul></li><li data-nav-id=/security/ title="WAF & Shield Deployment" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/security/>WAF & Shield Deployment</a><ul><li data-nav-id=/security/guide/readme/ title=Deployment class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/security/guide/readme/>Deployment</a></li></ul></li><li data-nav-id=/security-practice/ title="WAF & Shield Best Practice" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/security-practice/>WAF & Shield Best Practice</a><ul><li data-nav-id=/security-practice/juice-shop/readme/ title="Deploy OWASP Juice Shop" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/security-practice/juice-shop/readme/>Deploy OWASP Juice Shop</a></li><li data-nav-id=/security-practice/deploy/readme/ title="Deploy WAF & Shield Automations" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/security-practice/deploy/readme/>Deploy WAF & Shield Automations</a></li><li data-nav-id=/security-practice/rule-testing/readme/ title="Web ACLs and Managed Rules" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/security-practice/rule-testing/readme/>Web ACLs and Managed Rules</a></li><li data-nav-id=/security-practice/flood-testing/readme/ title="Prevent DDoS attacks" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/security-practice/flood-testing/readme/>Prevent DDoS attacks</a></li></ul></li><li data-nav-id=/contribution/ title=Contribution class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/contribution/>Contribution</a><ul><li data-nav-id=/contribution/pr/readme/ title="Contributing via pull requests" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/contribution/pr/readme/>Contributing via pull requests</a></li><li data-nav-id=/contribution/bug-report/readme/ title="Reporting issues" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/contribution/bug-report/readme/>Reporting issues</a></li></ul></li><li data-nav-id=/cleanup/ title=Cleanup class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/cleanup/>Cleanup</a><ul><li data-nav-id=/cleanup/s3-bucket/readme/ title="S3 bucket" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/cleanup/s3-bucket/readme/>S3 bucket</a></li><li data-nav-id=/cleanup/cognito-user-pool/readme/ title="Cognito User Pool" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/cleanup/cognito-user-pool/readme/>Cognito User Pool</a></li><li data-nav-id=/cleanup/cf-distribution/readme/ title="CloudFront distribution" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/cleanup/cf-distribution/readme/>CloudFront distribution</a></li><li data-nav-id=/cleanup/cloudformation/readme/ title=CloudFormation class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/cleanup/cloudformation/readme/>CloudFormation</a></li><li data-nav-id=/cleanup/cloudshell/readme/ title=CloudShell class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/cleanup/cloudshell/readme/>CloudShell</a></li><li data-nav-id=/cleanup/waf/readme/ title="WAF & Shield Automations" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/cleanup/waf/readme/>WAF & Shield Automations</a></li></ul></li><li data-nav-id=/reference/ title="Reference & Resources" class=dd-item><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/reference/>Reference & Resources</a></li></ul><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value;">
<option id=en value=https://awslabs.github.io/aws-cloudfront-extensions/workshop/develop/edge-function/readme/ selected>English</option></select><svg id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li></ul></section><section id=footer><left><a class=github-button href=https://github.com/awslabs/aws-cloudfront-extensions data-icon=octicon-cloud-download aria-label="Repo of awslabs/aws-cloudfront-extension on GitHub">Repo</a>
<a class=github-button href=https://github.com/awslabs/aws-cloudfront-extensions data-icon=octicon-star data-show-count=false aria-label="Star awslabs/aws-cloudfront-extension on GitHub">Star</a>
<a class=github-button href=https://github.com/awslabs/aws-cloudfront-extensions/fork data-icon=octicon-repo-forked data-show-count=false aria-label="Fork awslabs/aws-cloudfront-extension on GitHub">Fork</a><p><a href="https://aws.amazon.com/privacy/?nc1=f_pr">Privacy</a> | <a href="https://aws.amazon.com/terms/?nc1=f_pr">Site Terms</a> | © 2021, Amazon Web Services, Inc. or its affiliates. All rights reserved</p></left><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span><span class=links><a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/>CloudFront Extensions workshop</a> > <a href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/develop/>Develop with CloudFront Extensions</a> > Create a Lambda@Edge function</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#download-a-sample-aws-sam-application>Download a sample AWS SAM application</a></li><li><a href=#create-your-function>Create Your Function</a></li><li><a href=#build-and-deploy-your-application>Build and deploy your application</a></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Create a Lambda@Edge function</h1><p>In this step, you will create a Lambda function by AWS Serverless Application Model(SAM), the function adds code to update response headers in your CloudFront distribution.</p><h2 id=download-a-sample-aws-sam-application>Download a sample AWS SAM application</h2><p>After completing <strong>Upload CloudFront Extensions Code into CloudShell</strong> section, you have uploaded CloudFront Extensions into CloudShell, go to CloudFront Extensions folder and perform following commands:</p><pre><code>   cd edge/nodejs/
   sam init
</code></pre><p>Choose <strong>1 - AWS Quick Start Templates</strong></p><p><img src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/images/sam-init1.png alt="SAM init1"></p><p>Choose <strong>1 - Zip</strong></p><p><img src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/images/sam-package-type.png alt="SAM init package"></p><p>Choose <strong>1 - nodejs14.x</strong></p><p><img src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/images/sam-init2.png alt="SAM init2"></p><p>Enter project name <strong>update-response-header</strong> and choose <strong>1 - Hello World Example</strong> template</p><p><img src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/images/sam-init3.png alt="SAM init3"></p><p>Example output</p><p><img src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/images/sam-init-output.png alt="SAM init output"></p><p>This command creates a directory with the name that you provided as the project name. The contents of the project directory are similar to the following:</p><pre><code>   update-response-header/
   ├── README.md
   ├── events/
   │   └── event.json        #Contains the input for local test
   ├── hello_world/
   │   ├── app.js            #Contains AWS Lambda function logic
   │   ├── package.json      #Contains Nodejs dependencies 
   │   └── tests/
   │       └── unit/         #Contains your unit test case
   └── template.yaml         #Contains the AWS SAM template defining your application's AWS resources.
</code></pre><p>There are three especially important files:</p><ul><li><p><strong>template.yaml</strong>: Contains the AWS SAM template that defines your application&rsquo;s AWS resources.</p></li><li><p><strong>hello_world/app.js</strong>: Contains your actual Lambda handler logic.</p></li><li><p><strong>hello_world/package.json</strong>: Contains any Nodejs dependencies that the application requires, and is used for sam build.</p></li></ul><h2 id=create-your-function>Create Your Function</h2><p>To create a Lambda@Edge function</p><ol><li><p>Replace hello_world/app.js with following code, this will add a workshop header into response headers</p><pre><code> 'use strict';

 exports.lambdaHandler = async (event, context) =&gt; {

     const response = event.Records[0].cf.response;
     const headers = response.headers;
    
     headers['workshop'] = [{key: 'workshop', value: 'workshop demo header'}];
    
     return response;
 };
</code></pre></li><li><p>Modify template.yaml, you need to add an IAM role into the yaml file, it will be assumed by the service principals when they execute your function. The change is shown in below image, you only need to replace the original template.yaml with the <a href=https://github.com/awslabs/aws-cloudfront-extensions/blob/main/website/static/template/template.yaml>new one</a></p><p><img src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/images/yaml_changes.png alt="Yaml Changes"></p></li><li><p>[Optional] Add solution id</p><p>Solution id is a unique id assigned by AWS Solution team, you will need to add the solution id in template.yaml, all CloudFront Extensions solution id is <a href=https://quip-amazon.com/nXxXAl58SGQF/2021-Solution-Progress-Tracking-Board>here</a> under CloudFront Extensions tab.<div class="notices info"><p>Add Solution id is <strong>optional</strong> for this workshop, you can skip this step</p></div></p></li></ol><h2 id=build-and-deploy-your-application>Build and deploy your application</h2><p>First, change into the project directory, where the template.yaml file for the sample application is located, it is edge/nodejs/update-response-header in this workshop. Then run this command:</p><pre><code>sam build
</code></pre><p>Example output:</p><p><img src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/images/sam-build-output.png alt="SAM Build Output"></p><p>Run this command to deploy your application</p><pre><code>sam deploy --guided --capabilities CAPABILITY_NAMED_IAM
</code></pre><p>Follow the on-screen prompts. To accept the default options provided in the interactive experience, respond with <strong>Enter</strong></p><p>Example arguments:
<img src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/images/sam-deploy-args.png alt="SAM Deploy Args"></p><p>Example output:
<img src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/images/sam-deploy-output.png alt="SAM Deploy Output"></p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/develop/code-structure/readme/ title="Understand CloudFront Extensions code structure"><i class="fa fa-chevron-left"></i></a><a class="nav nav-next" href=https://awslabs.github.io/aws-cloudfront-extensions/workshop/develop/test-function/readme/ title="Test the Lambda@Edge function" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/js/clipboard.min.js?1665657764></script><script src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/js/perfect-scrollbar.min.js?1665657764></script><script src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/js/perfect-scrollbar.jquery.min.js?1665657764></script><script src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/js/jquery.sticky.js?1665657764></script><script src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/js/featherlight.min.js?1665657764></script><script src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/js/highlight.pack.js?1665657764></script><script>hljs.initHighlightingOnLoad();</script><script src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/js/modernizr.custom-3.6.0.js?1665657764></script><script src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/js/learn.js?1665657764></script><script src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/js/hugo-learn.js?1665657764></script><script src=https://awslabs.github.io/aws-cloudfront-extensions/workshop/mermaid/mermaid.js?1665657764></script><script>mermaid.initialize({startOnLoad:true});</script></body></html>