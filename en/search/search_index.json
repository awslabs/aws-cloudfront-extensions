{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Amazon CloudFront Extensions Amazon CloudFront Extensions includes three components: Lambda@Edge & CloudFront Functions collection, CloudFront Security Automations with Amazon WAF and Amazon Shield, and CloudFront Real-time Log Monitoring API. The solution aims to help customers use CloudFront more conveniently. One stop to find Lambda@Edge and CloudFront Function for different use cases This component provides a collection of Lambda@Edge and CloudFront Functions for common CloudFront use cases, such as redirect, authentication verification, pre-warm, and resizing image. Lambda@Edge Name Description Example Authentication with Cognito Integrate with Cognito to provide authentication service. - Add security headers Add security headers into response after successful authentication. Add 'strict-transport-security' to force browser using HTTPS. Serve content based on device type Redirect to the different version of an object based on the type of device that the user is using. Redirect to specific url if the request device is mobile. Cross origin resource sharing Support CORS (Cross Origin Resource Sharing) by Lambda@Edge. Add headers such as 'access-control-allow-origin', 'access-control-allow-headers'. Modify response status code Modify response status code to another status code. Modify status code from 200 to 206. Modify response header Modify response header as per configuration. - Access origin by weight rate Forward request to multiple origin regarding to pre-configured weight for each origin. - Failover to alternative origin Failover to alternative IP from pre-configured list, and return from success IP. Otherwise, retry until last one. - Support 302 from origin Process 302 response from origin, then access the redirected URL and return the response. - Pre-warm This Lambda will prewarm static content in specific pop. Prewarm content only in North America. Resize picture Resize pictures on the fly according to dimensions passed by the query parameter. Resize a picture from 1000x1000 to 200x300. Anti-hotlinking Protect against hotlinking. Users need to specify a referer allow list which supports wild card, and the request is rejected if the referer is not in the allow list. Only allow the requests from *.example.com. Standardize query string Standardize the query string before CloudFront forwards requests to your origin, thus improving the cache hit ratio. Update https://d111111abcdef8.cloudfront.net/images/image.jpg?Type=demo&Color=red to https://d111111abcdef8.cloudfront.net/images/image.jpg?color=red&type=demo. Authentication with Alibaba Cloud This solution provided by Goclouds Data is designed to achieve Alibaba Cloud CDN authentication. - Rewrite host for custom origin Rewrite host for custom origin. - Serverless load balancer The serverless load balancer solution will load balance for your origin via Lambda@Edge which is deployed upon CloudFront origin request. - Custom response with new URL Replace the response content with a new content. Replace the url \"www.original.com\" to \"www.new.com\" in the response. CloudFront Functions Name Description Example Add security headers Add several response headers to enable web browsers security features. Add 'strict-transport-security' to force browser using HTTPS. Cross origin resource sharing Support CORS (Cross Origin Resource Sharing) by CloudFront Function. Add headers such as 'access-control-allow-origin', 'access-control-allow-headers'. Add cache control headers Add a Cache-Control header for the browser so that content can be cached locally in the browser. - Add origin headers Add an Origin header if it is not present in the incoming request. The Origin header is part of Cross-Origin resource sharing (CORS), a mechanism using HTTP headers to tell browsers to give a web application running at one origin access to selected resources from a different origin. - Add true client IP headers Add a True-Client-IP header to include the IP address of a client connecting to CloudFront. Without this header, connections from CloudFront to your origin contain the IP address of the CloudFront server making the request to your origin, not the IP address of the client connected to CloudFront. - Redirect based on country Redirect a user to a country-specific version of a site based on the country of the user. - Default dir index Append index.html to the end of URLs that do not include a filename or extension. Update https://d111111abcdef8.cloudfront.net to https://d111111abcdef8.cloudfront.net/index.html. Verify JSON web token Validate a JSON Web Token (JWT) in the query string of the incoming request. - Customize request host Replaces host with the value in the customized header. The user may define a header awscustomhost. CloudFront Security Automations with Amazon WAF and Amazon Shield CloudFront Extensions provides a template that allows you to use Amazon WAF and Amazon Shield on CloudFront, it will automatically deploy a set of WAF rules and Shield protection groups into your account to secure your web applications against below attacks. SQL Injection and XSS: The solution configures two native WAF rules that are designed to protect against common SQL injection or cross-site scripting (XSS) patterns in the URI, query string, or body of a request. HTTP flood: This component protects against attacks that consist of a large number of requests from a particular IP address, such as a web-layer DDoS attack or a brute-force login attempt. Bad Bots: This component automatically sets up a honeypot, which is a security mechanism intended to lure and deflect an attempted attack. Scanners and Probes: This component parses application access logs searching for suspicious behavior, such as an abnormal amount of errors generated by an origin. It then blocks those suspicious source IP addresses for a customer-defined period of time. IP Reputation Lists: IP Lists Parser Lambda function which checks third-party IP reputation lists hourly for new ranges to block. Deny list and allow list: This component creates two specific WAF rules that allow you to manually insert IP addresses that you want to block or allow. CloudFront Real-time Log Monitoring API CloudFront Extensions provides a monitoring API, which obtains metrics such as cache hit rate and download rate by analyzing CloudFront real-time logs, and outputs them through RESTful API. This solution can satisfy flexible customization requirements, and customize indicator logic from real-time logs according to your specific requirements, which can be implemented by SQL statements in Athena. The following 10 reference metrics are provided: request: the number of requests from the client to CloudFront requestOrigin: the number of requests back to the origin statusCode: the status code from the client to CloudFront statusCodeOrigin: the status code of the back-to-origin bandwidth: the bandwidth from the client to CloudFront bandwidthOrigin: bandwidth back to origin chr: cache hit rate calculated by the number of requests chrBandWith: cache hit ratio calculated by bandwidth downloadSpeed: download speed from client to CloudFront downloadSpeedOrigin: the download speed of the back-to-origin The above reference indicators effectively supplement the current CloudWatch monitoring indicators for CloudFront, which can help you understand the operation of CloudFront from multiple dimensions. For the default built-in monitoring metrics of CloudFront, refer to Monitoring CloudFront with Amazon CloudWatch . This implementation guide describes architectural considerations and configuration steps for deploying CloudFront Extensions in the Amazon Web Services Cloud. It includes links to an Amazon Web Services CloudFormation template that launches and configures the services required to deploy this solution using Amazon Web Services best practices for security and availability. The guide is intended for IT architects, and developers who have practical experience architecting in the Amazon Web Services Cloud.","title":"Welcome"},{"location":"#amazon-cloudfront-extensions","text":"Amazon CloudFront Extensions includes three components: Lambda@Edge & CloudFront Functions collection, CloudFront Security Automations with Amazon WAF and Amazon Shield, and CloudFront Real-time Log Monitoring API. The solution aims to help customers use CloudFront more conveniently.","title":"Amazon CloudFront Extensions"},{"location":"#one-stop-to-find-lambdaedge-and-cloudfront-function-for-different-use-cases","text":"This component provides a collection of Lambda@Edge and CloudFront Functions for common CloudFront use cases, such as redirect, authentication verification, pre-warm, and resizing image.","title":"One stop to find Lambda@Edge and CloudFront Function for different use cases"},{"location":"#lambdaedge","text":"Name Description Example Authentication with Cognito Integrate with Cognito to provide authentication service. - Add security headers Add security headers into response after successful authentication. Add 'strict-transport-security' to force browser using HTTPS. Serve content based on device type Redirect to the different version of an object based on the type of device that the user is using. Redirect to specific url if the request device is mobile. Cross origin resource sharing Support CORS (Cross Origin Resource Sharing) by Lambda@Edge. Add headers such as 'access-control-allow-origin', 'access-control-allow-headers'. Modify response status code Modify response status code to another status code. Modify status code from 200 to 206. Modify response header Modify response header as per configuration. - Access origin by weight rate Forward request to multiple origin regarding to pre-configured weight for each origin. - Failover to alternative origin Failover to alternative IP from pre-configured list, and return from success IP. Otherwise, retry until last one. - Support 302 from origin Process 302 response from origin, then access the redirected URL and return the response. - Pre-warm This Lambda will prewarm static content in specific pop. Prewarm content only in North America. Resize picture Resize pictures on the fly according to dimensions passed by the query parameter. Resize a picture from 1000x1000 to 200x300. Anti-hotlinking Protect against hotlinking. Users need to specify a referer allow list which supports wild card, and the request is rejected if the referer is not in the allow list. Only allow the requests from *.example.com. Standardize query string Standardize the query string before CloudFront forwards requests to your origin, thus improving the cache hit ratio. Update https://d111111abcdef8.cloudfront.net/images/image.jpg?Type=demo&Color=red to https://d111111abcdef8.cloudfront.net/images/image.jpg?color=red&type=demo. Authentication with Alibaba Cloud This solution provided by Goclouds Data is designed to achieve Alibaba Cloud CDN authentication. - Rewrite host for custom origin Rewrite host for custom origin. - Serverless load balancer The serverless load balancer solution will load balance for your origin via Lambda@Edge which is deployed upon CloudFront origin request. - Custom response with new URL Replace the response content with a new content. Replace the url \"www.original.com\" to \"www.new.com\" in the response.","title":"Lambda@Edge"},{"location":"#cloudfront-functions","text":"Name Description Example Add security headers Add several response headers to enable web browsers security features. Add 'strict-transport-security' to force browser using HTTPS. Cross origin resource sharing Support CORS (Cross Origin Resource Sharing) by CloudFront Function. Add headers such as 'access-control-allow-origin', 'access-control-allow-headers'. Add cache control headers Add a Cache-Control header for the browser so that content can be cached locally in the browser. - Add origin headers Add an Origin header if it is not present in the incoming request. The Origin header is part of Cross-Origin resource sharing (CORS), a mechanism using HTTP headers to tell browsers to give a web application running at one origin access to selected resources from a different origin. - Add true client IP headers Add a True-Client-IP header to include the IP address of a client connecting to CloudFront. Without this header, connections from CloudFront to your origin contain the IP address of the CloudFront server making the request to your origin, not the IP address of the client connected to CloudFront. - Redirect based on country Redirect a user to a country-specific version of a site based on the country of the user. - Default dir index Append index.html to the end of URLs that do not include a filename or extension. Update https://d111111abcdef8.cloudfront.net to https://d111111abcdef8.cloudfront.net/index.html. Verify JSON web token Validate a JSON Web Token (JWT) in the query string of the incoming request. - Customize request host Replaces host with the value in the customized header. The user may define a header awscustomhost.","title":"CloudFront Functions"},{"location":"#cloudfront-security-automations-with-amazon-waf-and-amazon-shield","text":"CloudFront Extensions provides a template that allows you to use Amazon WAF and Amazon Shield on CloudFront, it will automatically deploy a set of WAF rules and Shield protection groups into your account to secure your web applications against below attacks. SQL Injection and XSS: The solution configures two native WAF rules that are designed to protect against common SQL injection or cross-site scripting (XSS) patterns in the URI, query string, or body of a request. HTTP flood: This component protects against attacks that consist of a large number of requests from a particular IP address, such as a web-layer DDoS attack or a brute-force login attempt. Bad Bots: This component automatically sets up a honeypot, which is a security mechanism intended to lure and deflect an attempted attack. Scanners and Probes: This component parses application access logs searching for suspicious behavior, such as an abnormal amount of errors generated by an origin. It then blocks those suspicious source IP addresses for a customer-defined period of time. IP Reputation Lists: IP Lists Parser Lambda function which checks third-party IP reputation lists hourly for new ranges to block. Deny list and allow list: This component creates two specific WAF rules that allow you to manually insert IP addresses that you want to block or allow.","title":"CloudFront Security Automations with Amazon WAF and Amazon Shield"},{"location":"#cloudfront-real-time-log-monitoring-api","text":"CloudFront Extensions provides a monitoring API, which obtains metrics such as cache hit rate and download rate by analyzing CloudFront real-time logs, and outputs them through RESTful API. This solution can satisfy flexible customization requirements, and customize indicator logic from real-time logs according to your specific requirements, which can be implemented by SQL statements in Athena. The following 10 reference metrics are provided: request: the number of requests from the client to CloudFront requestOrigin: the number of requests back to the origin statusCode: the status code from the client to CloudFront statusCodeOrigin: the status code of the back-to-origin bandwidth: the bandwidth from the client to CloudFront bandwidthOrigin: bandwidth back to origin chr: cache hit rate calculated by the number of requests chrBandWith: cache hit ratio calculated by bandwidth downloadSpeed: download speed from client to CloudFront downloadSpeedOrigin: the download speed of the back-to-origin The above reference indicators effectively supplement the current CloudWatch monitoring indicators for CloudFront, which can help you understand the operation of CloudFront from multiple dimensions. For the default built-in monitoring metrics of CloudFront, refer to Monitoring CloudFront with Amazon CloudWatch . This implementation guide describes architectural considerations and configuration steps for deploying CloudFront Extensions in the Amazon Web Services Cloud. It includes links to an Amazon Web Services CloudFormation template that launches and configures the services required to deploy this solution using Amazon Web Services best practices for security and availability. The guide is intended for IT architects, and developers who have practical experience architecting in the Amazon Web Services Cloud.","title":"CloudFront Real-time Log Monitoring API"},{"location":"additional-resources/","text":"Amazon API Gateway Amazon Athena Amazon CloudFront Amazon CloudFront Functions Amazon CloudFormation Amazon Cognito Amazon DynamoDB Amazon Glue Amazon Kinesis Amazon Kinesis Data Firehose Amazon Lambda Amazon Lambda@Edge Amazon Shield Amazon Simple Storage Service (Amazon S3) Amazon WAF","title":"Additional resources"},{"location":"architecture/","text":"Deploying CloudFront Extensions solution with the default parameters builds the following environment in the Amazon Web Services Cloud. Figure 1: CloudFront Extensions architecture Lambda@Edge & CloudFront Functions collection The collection includes multiple Lambda@Edge which can be deployed via SAR (Serverless Application Repository) and CloudFront Functions which can be deployed by CloudFormation. CloudFront security automations with Amazon WAF and Amazon Shield Figure 2: CloudFront security automations with Amazon WAF and Amazon Shield architecture The CloudFormation template provides the following components and workflows: Shield Deployment Lambda function will automatically deploy a protection group and protected resource to protect against DDoS attack. Log Parser Lambda function invokes Athena to query CloudFront access log and WAF log to find the request with times above the threshold, and add the IP into WAF to protect against DDoS attack. When the crawler triggers the trap URL, Badbot Parser Lambda function will add the IP into WAF to stop the crawler crawling the web site content. CloudWatch will invoke IP List Parser Lambda function at a fixed interval to update the malicious IP list from the third-party website. The automated deployed WAF rules will protect against SQL injection attack and XSS attack. CloudFront Real-time Log Monitoring API Figure 3: CloudFront Real-time Log Monitoring API architecture This solution deploys the Amazon CloudFormation template in your Amazon Web Services Cloud account and completes the following settings. Enable CloudFront real-time logs You need to configure the corresponding Kinesis data stream. Set up Kinesis Data Firehose to complete data transfer quickly This enables CloudFront's real-time logs to pass through Kinesis Data Stream and finally store them in S3 buckets through Kinesis Data Firehose. During this process, to monitor the download speed in each country and each ISP, Kinesis Data Firehose invokes the Amazon Lambda function Log Transformer to find the ISP and country code through the client IP, and cooperate with Kinesis Data Firehose to implement dynamic partitioning, that is, real-time logs are partitioned by partition key and stored in S3 bucket, such as year=2021/month=12/day=10. Query real-time logs in S3 via Athena In order to allow Athena to speed up data query through data partitioning, Amazon EventBridge will create all partitions for the next day every day, and delete the partitions of the previous day. The Lambda function MetricCollector is used to analyze real-time logs and collect monitoring metrics. It will be executed every 5 minutes. Save the results of query data in DynamoDB for subsequent retrieval Query the corresponding monitoring indicator data through Athena, such as calculating CHR (cache hit rate) and download rate through bandwidth, and finally store the monitoring indicator data in the DynamoDB table. The end user interface uses API Gateway The user interface generates a RESTful API through API Gateway and the Lambda function MetricManager. MetricManager reads the monitoring indicators in the DynamoDB table and returns the corresponding results. In order to further strengthen security management and restrict API access, Cognito authorization is enabled in API Gateway, and users who access the API need to carry a Cognito token to request the API normally.","title":"Architecture overview"},{"location":"architecture/#lambdaedge-cloudfront-functions-collection","text":"The collection includes multiple Lambda@Edge which can be deployed via SAR (Serverless Application Repository) and CloudFront Functions which can be deployed by CloudFormation.","title":"Lambda@Edge &amp; CloudFront Functions collection"},{"location":"architecture/#cloudfront-security-automations-with-amazon-waf-and-amazon-shield","text":"Figure 2: CloudFront security automations with Amazon WAF and Amazon Shield architecture The CloudFormation template provides the following components and workflows: Shield Deployment Lambda function will automatically deploy a protection group and protected resource to protect against DDoS attack. Log Parser Lambda function invokes Athena to query CloudFront access log and WAF log to find the request with times above the threshold, and add the IP into WAF to protect against DDoS attack. When the crawler triggers the trap URL, Badbot Parser Lambda function will add the IP into WAF to stop the crawler crawling the web site content. CloudWatch will invoke IP List Parser Lambda function at a fixed interval to update the malicious IP list from the third-party website. The automated deployed WAF rules will protect against SQL injection attack and XSS attack.","title":"CloudFront security automations with Amazon WAF and Amazon Shield"},{"location":"architecture/#cloudfront-real-time-log-monitoring-api","text":"Figure 3: CloudFront Real-time Log Monitoring API architecture This solution deploys the Amazon CloudFormation template in your Amazon Web Services Cloud account and completes the following settings. Enable CloudFront real-time logs You need to configure the corresponding Kinesis data stream. Set up Kinesis Data Firehose to complete data transfer quickly This enables CloudFront's real-time logs to pass through Kinesis Data Stream and finally store them in S3 buckets through Kinesis Data Firehose. During this process, to monitor the download speed in each country and each ISP, Kinesis Data Firehose invokes the Amazon Lambda function Log Transformer to find the ISP and country code through the client IP, and cooperate with Kinesis Data Firehose to implement dynamic partitioning, that is, real-time logs are partitioned by partition key and stored in S3 bucket, such as year=2021/month=12/day=10. Query real-time logs in S3 via Athena In order to allow Athena to speed up data query through data partitioning, Amazon EventBridge will create all partitions for the next day every day, and delete the partitions of the previous day. The Lambda function MetricCollector is used to analyze real-time logs and collect monitoring metrics. It will be executed every 5 minutes. Save the results of query data in DynamoDB for subsequent retrieval Query the corresponding monitoring indicator data through Athena, such as calculating CHR (cache hit rate) and download rate through bandwidth, and finally store the monitoring indicator data in the DynamoDB table. The end user interface uses API Gateway The user interface generates a RESTful API through API Gateway and the Lambda function MetricManager. MetricManager reads the monitoring indicators in the DynamoDB table and returns the corresponding results. In order to further strengthen security management and restrict API access, Cognito authorization is enabled in API Gateway, and users who access the API need to carry a Cognito token to request the API normally.","title":"CloudFront Real-time Log Monitoring API"},{"location":"cost/","text":"You are responsible for the cost of the Amazon services used while running this solution. We recommend creating a budget through Amazon Web Services Cost Explorer to help manage costs. For full details, refer to the pricing webpage for each service used in this solution. Lambda@Edge & CloudFront Functions Collection It contains a collection of Lambda@Edge and CloudFront Functions. Service Cost Lambda@Edge Pricing CloudFront Functions Pricing CloudFront Security Automations with Amazon WAF and Amazon Shield As of February 2022, to protect against HTTP flood, BadBot, SQL injection and XSS attacks, the estimated cost of using this solution is $22.84 per month in the US East (N. Virginia) Region (excludes free tier). Service Dimensions Cost/Month Amazon Kinesis Data Firehose 100 GB $2.9 Amazon Lambda 1M invocations average 500 millisecond and 512 MB memory $4.37 Amazon API Gateway 1M requests ~$3.5 Amazon Athena 1M queries 2GB data scanned per query $9.77 Amazon Simple Storage Service (S3) 100 GB $2.3 Total $22.84 CloudFront Real-time Log Monitoring API As of February 2022, to monitor 10 metrics for one CloudFront distribution which has 60 records (2KB) every second, the estimated cost of using this solution is $88.56 per month in the US East (N. Virginia) Region (excludes free tier). Service Dimensions Cost/Month Amazon Kinesis Data Firehose 60 records(2KB)/second Dynamic Partitioning enabled $36.9 Amazon Kinesis Data Stream 1 shard 60 records(2KB)/second 168 hours data retention $27.76 Amazon Lambda 86K invocations average 500 millisecond and 512MB memory $0.38 Amazon API Gateway 86K requests $0.09 Amazon Athena 86K queries 35MB data scanned per query $14.42 Amazon Simple Storage Service (S3) 295GB $6.79 Amazon Cognito 30 MAU $1.5 Amazon DynamoDB 1GB data storage 2 writes per minute 1 read every 2 minutes $0.72 Total $88.56","title":"Cost"},{"location":"cost/#lambdaedge-cloudfront-functions-collection","text":"It contains a collection of Lambda@Edge and CloudFront Functions. Service Cost Lambda@Edge Pricing CloudFront Functions Pricing","title":"Lambda@Edge &amp; CloudFront Functions Collection"},{"location":"cost/#cloudfront-security-automations-with-amazon-waf-and-amazon-shield","text":"As of February 2022, to protect against HTTP flood, BadBot, SQL injection and XSS attacks, the estimated cost of using this solution is $22.84 per month in the US East (N. Virginia) Region (excludes free tier). Service Dimensions Cost/Month Amazon Kinesis Data Firehose 100 GB $2.9 Amazon Lambda 1M invocations average 500 millisecond and 512 MB memory $4.37 Amazon API Gateway 1M requests ~$3.5 Amazon Athena 1M queries 2GB data scanned per query $9.77 Amazon Simple Storage Service (S3) 100 GB $2.3 Total $22.84","title":"CloudFront Security Automations with Amazon WAF and Amazon Shield"},{"location":"cost/#cloudfront-real-time-log-monitoring-api","text":"As of February 2022, to monitor 10 metrics for one CloudFront distribution which has 60 records (2KB) every second, the estimated cost of using this solution is $88.56 per month in the US East (N. Virginia) Region (excludes free tier). Service Dimensions Cost/Month Amazon Kinesis Data Firehose 60 records(2KB)/second Dynamic Partitioning enabled $36.9 Amazon Kinesis Data Stream 1 shard 60 records(2KB)/second 168 hours data retention $27.76 Amazon Lambda 86K invocations average 500 millisecond and 512MB memory $0.38 Amazon API Gateway 86K requests $0.09 Amazon Athena 86K queries 35MB data scanned per query $14.42 Amazon Simple Storage Service (S3) 295GB $6.79 Amazon Cognito 30 MAU $1.5 Amazon DynamoDB 1GB data storage 2 writes per minute 1 read every 2 minutes $0.72 Total $88.56","title":"CloudFront Real-time Log Monitoring API"},{"location":"deployment/","text":"Before you launch the solution, review the architecture, supported regions, and other considerations discussed in this guide. Follow the step-by-step instructions in this section to configure and deploy the solution into your account. Lambda@Edge & CloudFront Functions collection Time to deploy : Approximately 3 minutes Deployment overview Click below deploy button to deploy this solution in your Amazon Web Services account. As for Lambda@Edge functions, you can also find and configure them by searching aws-cloudfront-extensions in the Amazon SAR (Serverless Application Repository). For more information about Lambda@Edge and CloudFront functions, see Welcome . Lambda@Edge Name Deploy Authentication with Cognito Adding security header Serve content based on device type Cross origin resource sharing Modify response status code Modify response header Access origin by weight rate Failover to alternative origin Support 302 from origin Pre-warm Resize picture Anti-hotlinking Standardize query string Authentication with Alibaba Cloud Rewrite host for custom origin Serverless load balancer Custom response with new URL CloudFront Functions Name Deploy Add security headers Cross origin resource sharing Add cache control headers Add origin headers Add true client IP headers Redirect based on country Default dir index Verify JSON web token Customize request host Lambda@Edge Deployment in SAR Access the Amazon Serverless Application Repository page in the Console. Check Show apps that create custom IAM roles or resource policies . Search aws-cloudfront-extensions to display all extensions, and choose an application (for example, serving-based-on-device) and click Deploy . On the application detail page, check I acknowledge that this app creates custom IAM roles . Choose Deploy . After the deployment is completed, it will redirect to Lambda application page, and you can deploy it to Lambda@Edge. CloudFront security automations with Amazon WAF and Amazon Shield Time to deploy : Approximately 15 minutes Deployment overview Use the following steps to deploy this solution on Amazon Web Services. Launch the CloudFormation template into your Amazon Web Services account. Review the template parameters, and adjust them if necessary. Deployment steps Sign in to the Amazon Web Services Management Console and select the button to launch the CloudFormation template. You can also download the template as a starting point for your own implementation. The template launches in the US East (N. Virginia) Region by default. To launch the solution in a different AWS Region, use the Region selector in the console navigation bar. Under Parameters, review the parameters for the template, and modify them as necessary. Parameter Default value Description WAFBlockPeriod 240 The period (in minutes) to block applicable IP addresses. WAFScope CLOUDFRONT Specifies whether this is for an Amazon Web Services CloudFront distribution. appAccessLogBucket access-log-bucket-cloudfront The name for the Amazon S3 bucket where you want to store Cloud Front access logs for your CloudFront distribution. errorThreshold 50 The maximum acceptable bad requests per minute per IP. requestThreshold 100 The maximum acceptable requests per FIVE-minute period per IP address. wafLogBucketName waf-log-bucket-cloudfront The name for the Amazon S3 bucket where you want to store WAF access logs. !!! note \"Note\" If the parameter WAFScope uses the default value CLOUDFRONT, you must create your WAFv2 resources in the US East (N. Virginia) Region, us-east-1. Choose Next . On the Configure stack options page, you can specify tags (key-value pairs) for resources in your stack and set additional options, and then choose Next . On the Review page, review and confirm the settings. Check the boxes acknowledging that the template will create Amazon Web Services Identity and Access Management (IAM) resources and any additional capabilities required. Choose Create to deploy the stack. You can view the status of the stack in the CloudFormation Console in the Status column. You should receive a CREATE_COMPLETE status in approximately 15 minutes. To see details for the stack resources, choose the Outputs tab. CloudFront Real-time Log Monitoring API Time to deploy : Approximately 15 minutes Deployment overview Use the following steps to deploy this solution on Amazon Web Services. Launch the CloudFormation template into your Amazon Web Services account. Review the template parameters, and adjust them if necessary. Deployment steps Sign in to the Amazon Web Services Management Console and select the button to launch the CloudFormation template. You can also download the template as a starting point for your own implementation. The template launches in the US East (N. Virginia) Region by default. To launch the solution in a different Amazon Web Services Region, use the Region selector in the console navigation bar. Under Parameters, review the parameters for the template, and modify them as necessary. Parameter Default value Description CloudFrontDomainList - The CloudFront domain name list. Use comma as separation for multiple domain names. CloudFrontLogKeepDays 120 The number of days to keep CloudFront realtime logs in the S3 bucket. deployStage prod API Gateway deployment stage. Choose Next . On the Configure stack options page, you can specify tags (key-value pairs) for resources in your stack and set additional options, and then choose Next . On the Review page, review and confirm the settings. Check the boxes acknowledging that the template will create Amazon Web Services Identity and Access Management (IAM) resources and any additional capabilities required. Choose Create to deploy the stack. You can view the status of the stack in the CloudFormation Console in the Status column. You should receive a CREATE_COMPLETE status in approximately 15 minutes. To see details for the stack resources, choose the Outputs tab.","title":"Automated deployment"},{"location":"deployment/#lambdaedge-cloudfront-functions-collection","text":"Time to deploy : Approximately 3 minutes","title":"Lambda@Edge &amp; CloudFront Functions collection"},{"location":"deployment/#deployment-overview","text":"Click below deploy button to deploy this solution in your Amazon Web Services account. As for Lambda@Edge functions, you can also find and configure them by searching aws-cloudfront-extensions in the Amazon SAR (Serverless Application Repository). For more information about Lambda@Edge and CloudFront functions, see Welcome .","title":"Deployment overview"},{"location":"deployment/#lambdaedge","text":"Name Deploy Authentication with Cognito Adding security header Serve content based on device type Cross origin resource sharing Modify response status code Modify response header Access origin by weight rate Failover to alternative origin Support 302 from origin Pre-warm Resize picture Anti-hotlinking Standardize query string Authentication with Alibaba Cloud Rewrite host for custom origin Serverless load balancer Custom response with new URL","title":"Lambda@Edge"},{"location":"deployment/#cloudfront-functions","text":"Name Deploy Add security headers Cross origin resource sharing Add cache control headers Add origin headers Add true client IP headers Redirect based on country Default dir index Verify JSON web token Customize request host","title":"CloudFront Functions"},{"location":"deployment/#lambdaedge-deployment-in-sar","text":"Access the Amazon Serverless Application Repository page in the Console. Check Show apps that create custom IAM roles or resource policies . Search aws-cloudfront-extensions to display all extensions, and choose an application (for example, serving-based-on-device) and click Deploy . On the application detail page, check I acknowledge that this app creates custom IAM roles . Choose Deploy . After the deployment is completed, it will redirect to Lambda application page, and you can deploy it to Lambda@Edge.","title":"Lambda@Edge Deployment in SAR"},{"location":"deployment/#cloudfront-security-automations-with-amazon-waf-and-amazon-shield","text":"Time to deploy : Approximately 15 minutes","title":"CloudFront security automations with Amazon WAF and Amazon Shield"},{"location":"deployment/#deployment-overview_1","text":"Use the following steps to deploy this solution on Amazon Web Services. Launch the CloudFormation template into your Amazon Web Services account. Review the template parameters, and adjust them if necessary.","title":"Deployment overview"},{"location":"deployment/#deployment-steps","text":"Sign in to the Amazon Web Services Management Console and select the button to launch the CloudFormation template. You can also download the template as a starting point for your own implementation. The template launches in the US East (N. Virginia) Region by default. To launch the solution in a different AWS Region, use the Region selector in the console navigation bar. Under Parameters, review the parameters for the template, and modify them as necessary. Parameter Default value Description WAFBlockPeriod 240 The period (in minutes) to block applicable IP addresses. WAFScope CLOUDFRONT Specifies whether this is for an Amazon Web Services CloudFront distribution. appAccessLogBucket access-log-bucket-cloudfront The name for the Amazon S3 bucket where you want to store Cloud Front access logs for your CloudFront distribution. errorThreshold 50 The maximum acceptable bad requests per minute per IP. requestThreshold 100 The maximum acceptable requests per FIVE-minute period per IP address. wafLogBucketName waf-log-bucket-cloudfront The name for the Amazon S3 bucket where you want to store WAF access logs. !!! note \"Note\" If the parameter WAFScope uses the default value CLOUDFRONT, you must create your WAFv2 resources in the US East (N. Virginia) Region, us-east-1. Choose Next . On the Configure stack options page, you can specify tags (key-value pairs) for resources in your stack and set additional options, and then choose Next . On the Review page, review and confirm the settings. Check the boxes acknowledging that the template will create Amazon Web Services Identity and Access Management (IAM) resources and any additional capabilities required. Choose Create to deploy the stack. You can view the status of the stack in the CloudFormation Console in the Status column. You should receive a CREATE_COMPLETE status in approximately 15 minutes. To see details for the stack resources, choose the Outputs tab.","title":"Deployment steps"},{"location":"deployment/#cloudfront-real-time-log-monitoring-api","text":"Time to deploy : Approximately 15 minutes","title":"CloudFront Real-time Log Monitoring API"},{"location":"deployment/#deployment-overview_2","text":"Use the following steps to deploy this solution on Amazon Web Services. Launch the CloudFormation template into your Amazon Web Services account. Review the template parameters, and adjust them if necessary.","title":"Deployment overview"},{"location":"deployment/#deployment-steps_1","text":"Sign in to the Amazon Web Services Management Console and select the button to launch the CloudFormation template. You can also download the template as a starting point for your own implementation. The template launches in the US East (N. Virginia) Region by default. To launch the solution in a different Amazon Web Services Region, use the Region selector in the console navigation bar. Under Parameters, review the parameters for the template, and modify them as necessary. Parameter Default value Description CloudFrontDomainList - The CloudFront domain name list. Use comma as separation for multiple domain names. CloudFrontLogKeepDays 120 The number of days to keep CloudFront realtime logs in the S3 bucket. deployStage prod API Gateway deployment stage. Choose Next . On the Configure stack options page, you can specify tags (key-value pairs) for resources in your stack and set additional options, and then choose Next . On the Review page, review and confirm the settings. Check the boxes acknowledging that the template will create Amazon Web Services Identity and Access Management (IAM) resources and any additional capabilities required. Choose Create to deploy the stack. You can view the status of the stack in the CloudFormation Console in the Status column. You should receive a CREATE_COMPLETE status in approximately 15 minutes. To see details for the stack resources, choose the Outputs tab.","title":"Deployment steps"},{"location":"notices/","text":"Customers are responsible for making their own independent assessment of the information in this document. This document: (a) is for informational purposes only, (b) represents Amazon Web Services current product offerings and practices, which are subject to change without notice, and (c) does not create any commitments or assurances from Amazon Web Services and its affiliates, suppliers or licensors. Amazon Web Services products or services are provided \u201cas is\u201d without warranties, representations, or conditions of any kind, whether express or implied. Amazon Web Services responsibilities and liabilities to its customers are controlled by Amazon Web Services agreements, and this document is not part of, nor does it modify, any agreement between Amazon Web Services and its customers. The CloudFront Extensions solution is licensed under the terms of the Apache License Version 2.0 available at The Apache Software Foundation .","title":"Notices"},{"location":"regions/","text":"As of February 2022, this solution is supported in the following Amazon Web Services Regions: Region Name Region ID US East (N. Virginia) us-east-1 US East (Ohio) us-east-2 US West (Oregon) us-west-2 Asia Pacific (Mumbai) ap-south-1 Asia Pacific (Tokyo) ap-northeast-1 Asia Pacific (Seoul) ap-northeast-2 Asia Pacific (Singapore) ap-southeast-1 Asia Pacific (Sydney) ap-southeast-2 Canada (Central) ca-central-1 Europe (Ireland) eu-west-1 Europe (London) eu-west-2 Europe (Paris) eu-west-3 Europe (Frankfurt) eu-central-1 South America (S\u00e3o Paulo) sa-east-1","title":"Supported regions"},{"location":"revisions/","text":"Date Change March 2021 Initial release of v1.0.0 July 2021 Released v1.1.0 1. Added 12 Lambda@Edge functions and 9 CloudFront Functions; 2. Added CloudFront security automation with Amazon WAF and Shield Advanced December 2021 Released v1.2.0 Added 10 Lambda@Edge functions and 2 CloudFront functions February 2022 Released v1.3.0 Added a CloudFront real-time log monitoring API which provides performance metrics","title":"Revisions"},{"location":"security/","text":"When you build systems on Amazon Web Services infrastructure, security responsibilities are shared between you and Amazon Web Services. This shared model reduces your operational burden because Amazon Web Services operates, manages, and controls the components including the host operating system, the virtualization layer, and the physical security of the facilities in which the services operate. For more information about Amazon Web Services security, visit Amazon Web Services Cloud Security . IAM roles Amazon Identity and Access Management (IAM) roles allow customers to assign granular access policies and permissions to services and users on the Amazon Web Services Cloud. This solution creates IAM roles that grant the solution\u2019s access between the solution components.","title":"Security"},{"location":"security/#iam-roles","text":"Amazon Identity and Access Management (IAM) roles allow customers to assign granular access policies and permissions to services and users on the Amazon Web Services Cloud. This solution creates IAM roles that grant the solution\u2019s access between the solution components.","title":"IAM roles"},{"location":"source/","text":"Visit our GitHub repository to download the templates and scripts for this solution. The CloudFront Extensions template is generated using the Amazon Cloud Development Kit (CDK) . Refer to the README.md file for additional information.","title":"Source code"},{"location":"template/","text":"To automate deployment, this solution uses the following Amazon CloudFormation templates, which you can download before deployment: CloudFront security automations with Amazon WAF and Amazon Shield AwsCloudfrontWafStack.template : Use this template to launch the solution and all associated components. The default configuration deploys Amazon API Gateway, Amazon Lambda, Amazon S3, Amazon Athena, Amazon CloudWatch, Amazon WAF and Amazon Shield Advanced, but you can customize the template to meet your specific needs. Monitoring solution CloudFrontMonitoringStack.template : Use this template to launch the solution and all associated components. The default configuration deploys Amazon API Gateway, Amazon Lambda, Amazon S3, Amazon Athena, Amazon Cognito and Amazon DynamoDB, but you can customize the template to meet your specific needs.","title":"CloudFormation template"},{"location":"template/#cloudfront-security-automations-with-amazon-waf-and-amazon-shield","text":"AwsCloudfrontWafStack.template : Use this template to launch the solution and all associated components. The default configuration deploys Amazon API Gateway, Amazon Lambda, Amazon S3, Amazon Athena, Amazon CloudWatch, Amazon WAF and Amazon Shield Advanced, but you can customize the template to meet your specific needs.","title":"CloudFront security automations with Amazon WAF and Amazon Shield"},{"location":"template/#monitoring-solution","text":"CloudFrontMonitoringStack.template : Use this template to launch the solution and all associated components. The default configuration deploys Amazon API Gateway, Amazon Lambda, Amazon S3, Amazon Athena, Amazon Cognito and Amazon DynamoDB, but you can customize the template to meet your specific needs.","title":"Monitoring solution"},{"location":"uninstall/","text":"To uninstall the CloudFront Extensions solution, you must delete the Amazon CloudFormation stack. You can use either the Amazon Management Console or the Amazon Command Line Interface (Amazon CLI) to delete the CloudFormation stack. Uninstall the stack using the Amazon Management Console Sign in to the Amazon CloudFormation console. Select this solution\u2019s installation parent stack. Choose Delete . Uninstall the stack using Amazon Command Line Interface Determine whether the Amazon Command Line Interface (Amazon CLI) is available in your environment. For installation instructions, refer to What Is the Amazon Command Line Interface in the Amazon CLI User Guide . After confirming that the Amazon CLI is available, run the following command. aws cloudformation delete-stack --stack-name <installation-stack-name> --region <aws-region>","title":"Uninstall the solution"},{"location":"uninstall/#uninstall-the-stack-using-the-amazon-management-console","text":"Sign in to the Amazon CloudFormation console. Select this solution\u2019s installation parent stack. Choose Delete .","title":"Uninstall the stack using the Amazon Management Console"},{"location":"uninstall/#uninstall-the-stack-using-amazon-command-line-interface","text":"Determine whether the Amazon Command Line Interface (Amazon CLI) is available in your environment. For installation instructions, refer to What Is the Amazon Command Line Interface in the Amazon CLI User Guide . After confirming that the Amazon CLI is available, run the following command. aws cloudformation delete-stack --stack-name <installation-stack-name> --region <aws-region>","title":"Uninstall the stack using Amazon Command Line Interface"}]}